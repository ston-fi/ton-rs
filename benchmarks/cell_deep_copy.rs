mod benchmark_utils;
use std::hint::black_box;
use std::sync::LazyLock;

use criterion::{criterion_group, criterion_main, Criterion};
use ton_core::cell::{BoC, TonCell};

const BOC_HEX_SHARD: &str = include_str!("../resources/tests/shard_block_6000000000000000_52111590.hex");
const BOC_HEX_TX: &str = "b5ee9c72010221010006680003b570808da102774645078fa3025a5fe96b00eb3e41a2d747492691405fe794d7d7b000037bc4f4066c50000000000000000000000000000000000000000000000000000000000000000000000000000000068bd6be30005c684917480102030201e0040500827290aec8965afabb16ebc3cb9b408ebae71b618d78788bc80d09843593cac98da4c526ed50c7e24e4532e50279389bac71aaf4c4524479b6c0ef206b82a6c2652a02150409012b73699867a5d0111f2002b16801af0dacaffaabdd86d8ba20a36ecf812fba87eed8600bffdce420ce7948ae89c5000202368409dd19141e3e8c09697fa5ac03acf9068b5d1d249a45017f9e535f5ed012b736980653001600006f789e80cd88d17ad7c7e006070201dd1a1b020134090800ab178d45190000000068bd6be15746a52880080154a7e584ea9e874575c782c5e2ff00e50e74e9ed28583db900e0b007c7952dbb002a94fcb09d53d0e8aeb8f058bc5fe01ca1ce9d3da50b07b7201c1600f8f2a5b7440501870800884ca0964464753ea7562e0cab65271a8f938bffc51534ec6768841edf086c2b000a0d47cc275c2e2b20c00217ba0e907f216a4a8394e8f0f12634d7552dbc0c7c60090114ff00f4a413f4bcf2c80b0a0201620b0c0202cc0d0e001ba0f605da89a1f401f481f481a8610201d40f10020120111200c30831c02497c138007434c0c05c6c2544d7c0fc03383e903e900c7e800c5c75c87e800c7e800c1cea6d0000b4c7e08403e29fa954882ea54c4d167c0278208405e3514654882ea58c511100fc02b80d60841657c1ef2ea4d67c02f817c12103fcbc2000113e910c1c2ebcb8536002012013140083d40106b90f6a2687d007d207d206a1802698fc1080bc6a28ca9105d41083deecbef09dd0958f97162e99f98fd001809d02811e428027d012c678b00e78b6664f6aa401f1503d33ffa00fa4021f001ed44d0fa00fa40fa40d4305136a1522ac705f2e2c128c2fff2e2c254344270542013541403c85004fa0258cf1601cf16ccc922c8cb0112f400f400cb00c920f9007074c8cb02ca07cbffc9d004fa40f40431fa0020d749c200f2e2c4778018c8cb055008cf1670fa0217cb6b13cc8150201201617009e8210178d4519c8cb1f19cb3f5007fa0222cf165006cf1625fa025003cf16c95005cc2391729171e25008a813a08209c9c380a014bcf2e2c504c98040fb001023c85004fa0258cf1601cf16ccc9ed5402f73b51343e803e903e90350c0234cffe80145468017e903e9014d6f1c1551cdb5c150804d50500f214013e809633c58073c5b33248b232c044bd003d0032c0327e401c1d3232c0b281f2fff274140371c1472c7cb8b0c2be80146a2860822625a019ad822860822625a028062849e5c412440e0dd7c138c34975c2c060181900d73b51343e803e903e90350c01f4cffe803e900c145468549271c17cb8b049f0bffcb8b08160824c4b402805af3cb8b0e0841ef765f7b232c7c572cfd400fe8088b3c58073c5b25c60063232c14933c59c3e80b2dab33260103ec01004f214013e809633c58073c5b3327b552000705279a018a182107362d09cc8cb1f5230cb3f58fa025007cf165007cf16c9718010c8cb0524cf165006fa0215cb6a14ccc971fb0010241023007cc30023c200b08e218210d53276db708010c8cb055008cf165004fa0216cb6a12cb1f12cb3fc972fb0093356c21e203c85004fa0258cf1601cf16ccc9ed540101201c0101201e01ab48001011b4204ee8c8a0f1f4604b4bfd2d601d67c8345ae8e924d2280bfcf29afaf70011099412c88c8ea7d4eac5c1956ca4e351f2717ff8a2a69d8ced1083dbe10d854404060c45b200006f789e80cd8cd17ad7c6c01d00667362d09c0000000068bd6be15746a52880080154a7e584ea9e874575c782c5e2ff00e50e74e9ed28583db900e0b007c7952dba00c948001011b4204ee8c8a0f1f4604b4bfd2d601d67c8345ae8e924d2280bfcf29afaf7002a94fcb09d53d0e8aeb8f058bc5fe01ca1ce9d3da50b07b7201c1600f8f2a5b7500ce118540608235a00006f789e80cd8ed17ad7c66a993b6d80000000345eb5f0c0009e44e50c0bfa600000000000000000be00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006fc987a7604c1468e8000000000004000000000004b14a1323e0b998acf6a6b08de34764e2c31093eeedf8a1c0703f85f5b2b34d4040d03b14";

static CELL_SHARD: LazyLock<TonCell> = LazyLock::new(|| BoC::from_hex(BOC_HEX_SHARD).unwrap().single_root().unwrap());

static CELL_TX: LazyLock<TonCell> = LazyLock::new(|| BoC::from_hex(BOC_HEX_TX).unwrap().single_root().unwrap());

// cargo bench --bench cell_deep_copy
fn benchmark_functions(c: &mut Criterion) {
    run_bench!(c, deep_copy_shard);
    run_bench!(c, deep_copy_tx);
}
fn deep_copy_shard() {
    let copy_cell = CELL_SHARD.deep_copy().unwrap();
    black_box(copy_cell);
}

fn deep_copy_tx() {
    let copy_cell = CELL_TX.deep_copy().unwrap();
    black_box(copy_cell);
}

criterion_group!(benches, benchmark_functions);
criterion_main!(benches);
